import Room from "@/app/room/[roomId]/Room";
import { CollaborativeApp } from "@/components/CollaborativeApp";
import { getDocumentName, updateDocumentName } from "@/database/utils";

export default async function Page({ params }: { params: { roomId: string } }) {
  async function onSubmit(formData: FormData) {
    "use server";

    const name = formData.get("name") as string;
    await updateDocumentName(params.roomId, name);
  }

  const documentName = await getDocumentName();

  return (
    <Room>
      <main className="max-w-[375px] mx-auto">
        <h1 className="mt-16 text-3xl font-bold tracking-tight">
          {documentName}
        </h1>
        <div className="opacity-70 pt-2 mt-3 mb-8 border-t">
          <CollaborativeApp />
        </div>
        <form action={onSubmit} className="flex flex-col gap-4">
          <div>
            <label
              htmlFor="name"
              className="block text-sm font-medium text-gray-900 mb-1.5"
            >
              Document name
            </label>
            <input
              className="border rounded shadow-sm px-3 py-2 w-full outline-black focus:outline-2 focus:outline"
              placeholder=""
              id="name"
              name="name"
              type="text"
              autoComplete="off"
              required
            />
          </div>
          <button className="px-3 py-2.5 bg-black hover:bg-gray-800 active:bg-black text-white rounded font-medium flex justify-center items-center">
            Send `revalidateTag` to all with
            <LiveblocksLogo />
          </button>
        </form>
      </main>
    </Room>
  );
}

function LiveblocksLogo() {
  return (
    <svg
      width="1369"
      height="187"
      viewBox="0 0 1369 187"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      className="h-3.5 w-auto ml-1.5 inline"
    >
      <path
        fillRule="evenodd"
        clipRule="evenodd"
        d="M312.417 1.87064H281.734L281.742 183.638H312.417V1.87064ZM369.348 53.8344H338.674V183.638H369.348V53.8344ZM369.348 0.473145H338.674V33.5551H369.348V0.473145ZM414.367 53.8344H381.401L427.81 183.638H462.042L508.45 53.8344H475.989L456.591 115.317C456.086 116.916 454.268 123.173 451.139 134.074L444.926 154.99C441.253 141.717 437.409 128.491 433.394 115.317L414.367 53.8344ZM634.103 94.401C631.563 85.6975 627.843 78.2983 622.935 72.2115C617.437 65.3793 610.471 60.0921 602.022 56.3731C593.65 52.5689 584.354 50.6745 574.127 50.6745C554.688 50.6745 539.133 56.7536 527.47 68.9197C521.651 75.2054 517.203 82.6316 514.407 90.7285C511.534 99.0896 510.097 108.345 510.097 118.485C510.097 140.2 515.89 156.978 527.477 168.81C539.219 180.805 554.86 186.806 574.383 186.806C591.119 186.806 604.678 183.049 615.084 175.525C625.483 168.003 632.37 156.853 635.749 142.063L605.826 139.781C604.391 147.808 601.09 153.81 595.933 157.777C590.776 161.667 583.508 163.616 574.127 163.616C552.662 163.616 541.673 151.527 541.168 127.358H637.776L637.907 123.05C637.907 112.654 636.634 103.104 634.103 94.401ZM548.01 85.2782C553.423 77.67 562.128 73.8652 574.127 73.8652C579.959 73.8652 584.866 74.6649 588.836 76.2725C592.811 77.8791 596.237 80.4563 599.109 84.0053C601.344 86.7591 603.062 89.8943 604.18 93.2591C605.441 96.7702 606.209 100.438 606.464 104.16H541.417C542.178 96.637 544.376 90.3406 548.01 85.2782ZM757.091 58.9119C748.385 53.2444 738.328 50.4183 726.92 50.4183H726.904C718.626 50.4183 711.062 52.1031 704.212 55.4881C697.474 58.7723 691.703 63.7513 687.47 69.9367V1.87064H656.794V183.638H687.477V165.767C691.366 172.189 696.875 177.476 703.452 181.1C710.301 184.905 717.865 186.806 726.143 186.806C737.644 186.806 747.826 184.058 756.718 178.569C765.586 173.08 772.475 165.215 777.375 154.99C782.36 144.68 784.861 132.599 784.861 118.74C784.861 105.216 782.399 93.3057 777.507 82.9956C772.685 72.5998 765.881 64.5718 757.091 58.9119ZM744.028 153.088C739.128 160.525 730.764 164.237 718.921 164.237C708.266 164.237 700.244 160.393 694.839 152.707C689.427 145.021 686.724 133.779 686.724 118.989C686.724 104.703 689.131 93.5549 693.946 85.5263C698.854 77.4132 707.094 73.3606 718.673 73.3606C730.508 73.3606 738.918 77.0796 743.904 84.5091C748.898 91.8616 751.382 103.275 751.382 118.74C751.382 134.198 748.937 145.65 744.028 153.088ZM834.694 1.87064H804.011V183.638H834.694V1.87064ZM884.396 178.693C894.375 184.104 906.203 186.806 919.902 186.806C933.088 186.806 944.667 183.973 954.638 178.32C964.54 172.817 972.608 164.529 977.843 154.486C983.333 144.175 986.082 132.257 986.082 118.74C986.082 105.728 983.38 94.0586 977.967 83.7561C972.779 73.5926 964.768 65.1413 954.894 59.4167C944.915 53.5859 933.252 50.6667 919.902 50.6667C906.459 50.6667 894.709 53.5859 884.652 59.4167C874.805 65.1165 866.795 73.517 861.572 83.624C856.253 93.8495 853.589 105.557 853.589 118.74C853.589 132.769 856.206 144.89 861.448 155.114C866.547 165.106 874.546 173.324 884.396 178.693ZM945.381 153.219C940.225 160.486 931.729 164.12 919.902 164.12C911.871 164.12 905.403 162.513 900.502 159.299C895.595 156.007 892.046 151.061 889.847 144.47C887.65 137.793 886.555 129.214 886.555 118.733C886.555 103.019 889.133 91.528 894.29 84.261C899.531 76.994 908.067 73.3606 919.902 73.3606C931.651 73.3606 940.101 76.994 945.257 84.261C950.499 91.528 953.116 103.019 953.116 118.74C953.116 134.455 950.538 145.945 945.381 153.219ZM1027.93 178.693C1037.82 184.104 1049.61 186.806 1063.31 186.806C1073.95 186.806 1083.47 184.951 1091.83 181.232C1100.21 177.513 1107 172.319 1112.24 165.642C1117.5 158.837 1120.95 150.809 1122.26 142.311L1092.72 139.276C1090.69 147.381 1087.31 153.43 1082.57 157.397C1077.84 161.372 1071.41 163.359 1063.31 163.359C1055.02 163.359 1048.51 161.667 1043.77 158.282C1039.05 154.82 1035.74 149.882 1033.89 143.453C1032.03 136.947 1031.1 128.709 1031.1 118.74C1031.1 108.935 1032.03 100.822 1033.89 94.401C1035.74 87.8945 1039 82.91 1043.65 79.4401C1048.39 75.8911 1054.93 74.1214 1063.31 74.1214C1072.26 74.1214 1078.9 76.6137 1083.21 81.5981C1087.6 86.497 1090.73 93.2125 1092.59 101.754L1121.63 96.5514C1118.84 82.6923 1112.54 71.5826 1102.73 63.2209C1093.01 54.8515 1079.87 50.6745 1063.31 50.6745C1049.78 50.6745 1038.07 53.5472 1028.18 59.2924C1018.41 64.914 1010.52 73.2915 1005.49 83.3759C1000.25 93.6015 997.623 105.387 997.623 118.74C997.623 132.847 1000.2 145.021 1005.36 155.246C1010.6 165.471 1018.12 173.289 1027.93 178.693ZM1169.31 135.471L1183.63 121.776L1221.67 183.638H1257.04L1204.43 102.126L1255.4 53.8344H1215.58L1169.31 101.249V1.87064H1138.62V183.638H1169.31V135.471ZM1283.93 182.116C1292.55 185.245 1302.14 186.805 1312.71 186.805C1328.85 186.805 1342.16 183.591 1352.65 177.178C1363.22 170.75 1368.5 160.269 1368.5 145.735C1368.5 136.27 1366.04 128.833 1361.15 123.429C1356.25 117.932 1350.41 114.003 1343.65 111.636C1336.97 109.19 1327.88 106.698 1316.39 104.159C1309.71 102.722 1304.43 101.371 1300.54 100.106C1296.65 98.8329 1293.52 97.1862 1291.16 95.1604C1288.88 93.1259 1287.73 90.5096 1287.73 87.303C1287.73 82.5677 1289.85 78.9808 1294.07 76.527C1298.3 74.0736 1303.54 72.8469 1309.79 72.8469C1318.07 72.8469 1324.54 74.8344 1329.2 78.8096C1333.93 82.7844 1336.46 88.7395 1336.8 96.6825L1365.2 91.9927C1363.84 77.4587 1358.14 66.9386 1348.08 60.4247C1338.11 53.9263 1325.34 50.6655 1309.79 50.6655C1300.66 50.6655 1292.22 52.0552 1284.44 54.8502C1276.74 57.552 1270.54 61.8222 1265.8 67.6606C1261.06 73.4835 1258.7 80.8355 1258.7 89.7101C1258.7 97.9088 1260.73 104.539 1264.78 109.609C1268.91 114.733 1274.22 118.777 1280.26 121.394C1286.51 124.104 1294.36 126.682 1303.83 129.127L1311.7 131.03C1316.95 132.273 1322.15 133.711 1327.29 135.338C1330.84 136.441 1333.75 137.963 1336.04 139.903C1338.32 141.844 1339.46 144.384 1339.46 147.512C1339.46 153.002 1337.18 157.232 1332.61 160.183C1328.14 163.148 1321.58 164.624 1312.97 164.624C1304.17 164.624 1297.16 162.427 1291.91 158.033C1286.68 153.638 1284.02 147.302 1283.93 139.018L1255.03 142.31C1255.35 152.287 1258.11 160.61 1263.26 167.287C1268.51 173.964 1275.39 178.902 1283.93 182.116Z"
        fill="white"
      />
      <path
        fillRule="evenodd"
        clipRule="evenodd"
        d="M146.285 64.5H0L43.3438 107.833V167.417L146.285 64.5Z"
        fill="white"
      />
      <path
        fillRule="evenodd"
        clipRule="evenodd"
        d="M70.4336 183.667H216.719L173.375 140.333V80.75L70.4336 183.667Z"
        fill="white"
      />
    </svg>
  );
}
